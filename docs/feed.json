{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "Dan Gibbs Feed",
  "language": "en-GB",
  "home_page_url": "https://dangibbs.uk",
  "feed_url": "https://dangibbs.uk/feed.json",
  "description": "Posts and articles from dangibbs.uk",
  "author": {
    "name": "Dan Gibbs",
    "url": "https://dangibbs.uk"
  },
  "items": [{
      "id": "https://dangibbs.uk/blog/running-systemd-docker-containers-archlinux/",
      "url": "https://dangibbs.uk/blog/running-systemd-docker-containers-archlinux/",
      "title": "How to run systemd Docker containers in Arch Linux",
      "content_html": "<p>Docker engine <a href=\"https://docs.docker.com/engine/release-notes/#20106\">20.10.6</a>\nrecently moved its cgroup v2 support out of experimental but it does not\nsupport <em>hybrid</em> hierarchies. Most modern systemd packages for Linux\ndistributions are compiled and shipped with the hybrid hierarchy which is a\nsystemd recommended default.</p>\n<p>You can view your host systemd environment with:</p>\n<pre class=\"language-bash\" tabindex=\"0\"><code class=\"language-bash\">systemctl show -all <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> default-hierarchy</code></pre>\n<p>If the default hierarchy is listed as hybrid <code>default-hierarchy=hybrid</code> there\nwill likely be issues (regardless of read/write permissions) when running\nsystemd as an init system inside a Docker container.</p>\n<h2 id=\"goto-example\" tabindex=\"-1\">Example</h2>\n<p>Running the following <code>litmusimage/ubuntu</code> container fails to start.</p>\n<pre class=\"language-bash\" tabindex=\"0\"><code class=\"language-bash\">docker run -it --privileged --volume /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /tmp:exec litmusimage/ubuntu:20.04</code></pre>\n<p>Example init errors returned:</p>\n<pre class=\"language-bash\" tabindex=\"0\"><code class=\"language-bash\">Failed to create /init.scope control group: Read-only <span class=\"token function\">file</span> system<br>Failed to allocate manager object: Read-only <span class=\"token function\">file</span> system<br><span class=\"token punctuation\">[</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span> Failed to allocate manager object.<br>Exiting PID <span class=\"token number\">1</span><span class=\"token punctuation\">..</span>.</code></pre>\n<h2 id=\"goto-workaround\" tabindex=\"-1\">Workaround</h2>\n<p>Disable the hybrid hierarchy by setting the kernel parameter\n<code>systemd.unified_cgroup_hierarchy=0</code> from your boot loader or during kernel\ncompilation.</p>\n<h2 id=\"goto-grub-example\" tabindex=\"-1\">GRUB Example</h2>\n<p>Kernel parameters can be set in GRUB 2 by appending the <code>GRUB_CMDLINE_LINUX</code>\nor <code>GRUB_CMDLINE_LINUX_DEFAULT</code> options.</p>\n<pre class=\"language-ini\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"token comment\"># /etc/default/grub</span><br><span class=\"token key attr-name\">GRUB_CMDLINE_LINUX_DEFAULT</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"\"</span><br><span class=\"token key attr-name\">GRUB_CMDLINE_LINUX</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"<span class=\"token inner-value\">quiet systemd.unified_cgroup_hierarchy=0</span>\"</span></code></pre>\n<p>Regenerate the GRUB configuration with:</p>\n<pre class=\"language-bash\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"token function\">grub-mkconfig</span> -o /boot/grub/grub.cfg</code></pre>\n",
      "date_published": "2021-12-21T00:00:00Z"
    }
  ]
}
